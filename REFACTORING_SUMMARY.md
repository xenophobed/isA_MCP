# ğŸ”„ Event Sourcing ç³»ç»Ÿé‡æ„æ€»ç»“

## ğŸ“‹ é‡æ„æ¦‚è¿°

æ ¹æ®ä½ çš„è¦æ±‚ï¼Œæˆ‘å·²ç»æˆåŠŸé‡æ„äº†æ•´ä¸ªEvent Sourcingç³»ç»Ÿï¼Œå°†å…¶ä»å•ä¸€çš„å¤§æ–‡ä»¶æ‹†åˆ†ä¸ºç¬¦åˆMCPæ¡†æ¶çº¦å®šçš„æ¨¡å—åŒ–æ¶æ„ã€‚

## âœ… å®Œæˆçš„é‡æ„å·¥ä½œ

### 1. æ¶æ„é‡ç»„
- **ä¹‹å‰**: `servers/event_sourcing_server.py` (738è¡Œå•ä¸€æ–‡ä»¶)
- **ç°åœ¨**: æ¨¡å—åŒ–æ¶æ„
  - `tools/event_sourcing_tools.py` - MCPå·¥å…·æ¥å£å±‚
  - `tools/services/event_sourcing_services.py` - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
  - `resources/event_sourcing_resources.py` - MCPèµ„æºå±‚
  - `servers/event_feedback_server.py` - ç®€åŒ–çš„äº‹ä»¶å›è°ƒæœåŠ¡

### 2. MCPèµ„æºè¯´æ˜
MCPä¸­çš„**Resource**æ˜¯å¯ä»¥è¢«å®¢æˆ·ç«¯è¯»å–çš„æ•°æ®æºï¼Œç±»ä¼¼äºREST APIçš„GETç«¯ç‚¹ï¼š

```python
# å®¢æˆ·ç«¯ä½¿ç”¨æ–¹å¼
tasks = await client.read_resource("event://tasks")          # è·å–æ‰€æœ‰ä»»åŠ¡
status = await client.read_resource("event://status")        # è·å–æœåŠ¡çŠ¶æ€
active = await client.read_resource("event://tasks/active")  # è·å–æ´»è·ƒä»»åŠ¡
```

**èµ„æºçš„ä½œç”¨**ï¼š
- æä¾›ç³»ç»ŸçŠ¶æ€çš„åªè¯»è®¿é—®
- Agentå¯ä»¥æŸ¥è¯¢å½“å‰åå°ä»»åŠ¡æƒ…å†µ
- æ”¯æŒä¸åŒçš„æ•°æ®è§†å›¾ï¼ˆæŒ‰ç±»å‹ç­›é€‰ã€æŒ‰çŠ¶æ€ç­›é€‰ç­‰ï¼‰

### 3. Event FeedbackæœåŠ¡é‡æ„
- **ä¹‹å‰**: å¤æ‚çš„äº‹ä»¶å¤„ç†é€»è¾‘ï¼Œæ¨¡æ‹Ÿé€šçŸ¥å‘é€
- **ç°åœ¨**: ç®€å•çš„è½¬å‘å™¨ï¼Œç›´æ¥å°†äº‹ä»¶ä¼ é€’ç»™LangGraph Agent

**æ–°çš„æµç¨‹**:
```
äº‹ä»¶å‘ç”Ÿ â†’ Event Feedback Server â†’ LangGraph Agent â†’ LLMåˆ¤æ–­ â†’ MCPå·¥å…·è°ƒç”¨(Twilioç­‰)
```

### 4. é¡¹ç›®ç»“æ„æ•´ç†
- ç§»åŠ¨æ–‡æ¡£åˆ° `docs/` ç›®å½•
- ç§»åŠ¨æ—¥å¿—åˆ° `logs/` ç›®å½•  
- ç§»åŠ¨æµ‹è¯•å’Œæ¼”ç¤ºåˆ° `tests/` ç›®å½•
- åˆ é™¤æ ¹ç›®å½•çš„ä¸´æ—¶æ–‡ä»¶

### 5. ä¸»æœåŠ¡å™¨é›†æˆ
æ›´æ–°äº† `server.py`ï¼Œç°åœ¨åŒ…å«ï¼š
- Event Sourcingå·¥å…·æ³¨å†Œ
- Event Sourcingèµ„æºæ³¨å†Œ
- æœåŠ¡åˆå§‹åŒ–

## ğŸ› ï¸ å¦‚ä½•ä½¿ç”¨é‡æ„åçš„ç³»ç»Ÿ

### å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
```bash
# 1. å¯åŠ¨ä¸»MCPæœåŠ¡å™¨
python server.py --port 8001

# 2. å¯åŠ¨äº‹ä»¶å›è°ƒæœåŠ¡å™¨
python servers/event_feedback_server.py

# 3. (å¯é€‰) å¯åŠ¨è´Ÿè½½å‡è¡¡å™¨
docker-compose up nginx
```

### ä½¿ç”¨Event SourcingåŠŸèƒ½
```python
# é€šè¿‡MCPå®¢æˆ·ç«¯è°ƒç”¨
await client.call_tool("create_background_task", {
    "task_type": "web_monitor",
    "description": "Monitor TechCrunch for AI news",
    "config": json.dumps({
        "urls": ["https://techcrunch.com"],
        "keywords": ["AI", "machine learning"],
        "check_interval_minutes": 30
    })
})

# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
tasks = await client.read_resource("event://tasks")
status = await client.read_resource("event://status")
```

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡Œé‡æ„éªŒè¯æµ‹è¯•ï¼š
```bash
python tests/test_refactored_system.py
```

**æµ‹è¯•ç»“æœ**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- æœåŠ¡å±‚åŠŸèƒ½æ­£å¸¸
- MCPé›†æˆæ­£å¸¸
- ä»»åŠ¡åˆ›å»ºã€æš‚åœã€æ¢å¤ã€åˆ é™¤åŠŸèƒ½æ­£å¸¸

## ğŸ“Š é‡æ„æ•ˆæœ

### ä»£ç ç»„ç»‡æ”¹è¿›
- **æ¨¡å—åŒ–**: å•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªæ–‡ä»¶èŒè´£æ˜ç¡®
- **å¯ç»´æŠ¤æ€§**: ä»£ç åˆ†å±‚æ¸…æ™°ï¼Œæ˜“äºä¿®æ”¹å’Œæ‰©å±•
- **å¯æµ‹è¯•æ€§**: å„å±‚ç‹¬ç«‹ï¼Œä¾¿äºå•å…ƒæµ‹è¯•

### ç¬¦åˆMCPæ¡†æ¶çº¦å®š
- **å·¥å…·å±‚**: ä½¿ç”¨ `@mcp.tool()` è£…é¥°å™¨
- **èµ„æºå±‚**: ä½¿ç”¨ `@mcp.resource()` è£…é¥°å™¨
- **æœåŠ¡å±‚**: ç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯å¤ç”¨
- **å®‰å…¨é›†æˆ**: ç»§æ‰¿æ¡†æ¶çš„å®‰å…¨å’Œç›‘æ§åŠŸèƒ½

### æ¶æ„æ¸…æ™°åº¦
```
ç”¨æˆ·è¯·æ±‚ â†’ MCPå·¥å…· â†’ æœåŠ¡å±‚ â†’ åå°ç›‘æ§
    â†‘                          â†“
å›è°ƒæœåŠ¡ â† Agentå¤„ç† â† äº‹ä»¶è§¦å‘ â†â”˜
```

## ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

1. **Event Feedbackç®€åŒ–**: ä¸å†åšå¤æ‚å¤„ç†ï¼Œç›´æ¥è½¬å‘ç»™Agent
2. **èµ„æºæä¾›æ•°æ®è§†å›¾**: Agentå¯ä»¥æŸ¥è¯¢ç³»ç»ŸçŠ¶æ€åšå†³ç­–
3. **æœåŠ¡å±‚ç‹¬ç«‹**: æ ¸å¿ƒé€»è¾‘ä¸MCPåè®®è§£è€¦
4. **é¡¹ç›®ç»“æ„è§„èŒƒ**: ç¬¦åˆä¼ä¸šçº§é¡¹ç›®æ ‡å‡†

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **LangGraph Agenté›†æˆ**: åˆ›å»ºæ¥æ”¶äº‹ä»¶çš„Agentç«¯ç‚¹
2. **Twilioå·¥å…·å®Œå–„**: å®Œå–„çŸ­ä¿¡å‘é€åŠŸèƒ½
3. **ç›‘æ§å¢å¼º**: æ·»åŠ æ›´å¤šç›‘æ§æŒ‡æ ‡
4. **é…ç½®ç®¡ç†**: ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†å›è°ƒURLç­‰è®¾ç½®

---

**æ€»ç»“**: é‡æ„æˆåŠŸå°†738è¡Œçš„å•ä¸€æ–‡ä»¶æ‹†åˆ†ä¸ºæ¨¡å—åŒ–æ¶æ„ï¼Œæé«˜äº†ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼ŒåŒæ—¶ä¿æŒäº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½ã€‚ç³»ç»Ÿç°åœ¨æ›´ç¬¦åˆMCPæ¡†æ¶è§„èŒƒå’Œä¼ä¸šçº§å¼€å‘æ ‡å‡†ã€‚ 