# Web Crawl Tool

## Description
Intelligently crawl and analyze web pages using a **simplified hybrid approach**: BS4 text extraction (default) with VLM analysis fallback, all enhanced by LLM synthesis. Supports both single URL analysis and multiple URL comparison.

### Simplified Architecture
1. **Default**: BS4 text extraction using dedicated `bs4_service` (fast, clean, reliable)
2. **Fallback**: VLM analysis using `image_analyzer` (comprehensive visual understanding)
3. **Enhancement**: LLM synthesis using `text_generator` (intelligent analysis and reporting)

## Input Parameters
- `url` (string, required): Target web page URL or JSON array of URLs for comparison
- `analysis_request` (string, optional): Analysis request description (default: "")

### URL Formats
- Single URL: `"https://example.com"`
- Multiple URLs: `'[\"https://site1.com\", \"https://site2.com\"]'` (JSON array as string)

### Input Validation
- JSON arrays must contain only string URLs (numbers or other types rejected)
- Empty arrays `[]` are rejected
- JSON objects `{}` are rejected (only arrays supported for multiple URLs)
- Malformed JSON triggers validation errors

## Output Format

### Single URL Analysis
```json
{
  "status": "success|error",
  "action": "web_crawl",
  "timestamp": "2024-01-01T12:00:00Z",
  "data": {
    "success": true,
    "result": {
      "method": "bs4_extraction|vlm_analysis",
      "success": true,
      "content": "Clean extracted text content...",
      "title": "Page Title",
      "headings": [
        {"level": "h1", "text": "Main Heading"},
        {"level": "h2", "text": "Sub Heading"}
      ],
      "paragraphs": ["First paragraph...", "Second paragraph..."],
      "links": [
        {"text": "Link Text", "url": "https://example.com"}
      ],
      "word_count": 150,
      "processing_time": 0.45,
      "final_report": "Intelligent analysis report generated by LLM...",
      "raw_data": {
        "title": "Page Title",
        "content": "Content preview...",
        "headings_count": 2,
        "paragraphs_count": 3,
        "links_count": 1
      }
    },
    "url": "https://example.com",
    "analysis_request": "extract main content",
    "extraction_method": "bs4_extraction"
  }
}
```

### Multiple URL Comparison
```json
{
  "status": "success|error", 
  "action": "web_crawl_compare",
  "timestamp": "2024-01-01T12:00:00Z",
  "data": {
    "success": true,
    "comparison_report": "Comprehensive comparison analysis generated by LLM...",
    "urls_count": 2,
    "analysis_request": "compare product features",
    "urls": ["https://site1.com", "https://site2.com"],
    "processing_time_ms": 3500,
    "individual_results": [
      {
        "url": "https://site1.com",
        "item_index": 1,
        "analysis_result": {...},
        "success": true
      }
    ]
  }
}
```

### Result Object Structure

#### BS4 Extraction Result (Default)
- **`method`**: "bs4_extraction"
- **`success`**: Boolean indicating extraction success
- **`content`**: Clean text content extracted with BeautifulSoup
- **`title`**: Page title
- **`headings`**: Array of heading objects with level and text
- **`paragraphs`**: Array of meaningful paragraph text
- **`links`**: Array of link objects with text and URL
- **`word_count`**: Total word count of extracted content
- **`processing_time`**: Time taken in seconds
- **`final_report`**: LLM-generated analysis report (if analysis_request provided)
- **`raw_data`**: Summary metadata

#### VLM Analysis Result (Fallback)
- **`method`**: "vlm_analysis"
- **`success`**: Boolean indicating analysis success
- **`content`**: Rich analysis results from image analyzer
- **`model_used`**: AI model used for analysis
- **`processing_time`**: Time taken in seconds
- **`final_report`**: LLM-enhanced analysis report
- **`raw_data`**: Analysis metadata including model and timing info

## Error Response
```json
{
  "status": "error",
  "action": "web_crawl",
  "timestamp": "2024-01-01T12:00:00Z",
  "data": {},
  "error": "Error description"
}
```

## Example Usage
```python
# Single URL analysis
result = await client.call_tool("web_crawl", {
    "url": "https://example.com/article",
    "analysis_request": "extract main content and key points"
})

# Multiple URL comparison
result = await client.call_tool("web_crawl", {
    "url": '[\"https://site1.com\", \"https://site2.com\"]',
    "analysis_request": "compare product features and pricing"
})

# Simple crawl without specific analysis
result = await client.call_tool("web_crawl", {
    "url": "https://example.com"
})
```

## Simplified Method Selection

### BS4 Extraction (Default)
**Used for:** Almost all web pages by default

**Process:**
1. Fetch HTML content with requests
2. Parse with BeautifulSoup
3. Extract clean text, headings, paragraphs, links
4. Generate LLM analysis report (if requested)

**Benefits:**
- âš¡ **Fast**: 1-3 seconds for most pages (tested and verified)
- ðŸ’° **Cost-effective**: No AI model calls for extraction
- ðŸŽ¯ **Reliable**: Consistent, deterministic results
- ðŸ§¹ **Clean**: Well-structured text output
- ðŸ“Š **Structured**: Organized headings, paragraphs, links

### VLM Analysis (Fallback)
**Used when:** BS4 extraction fails or content is non-HTML

**Process:**
1. Launch browser with Playwright
2. Take screenshot of rendered page
3. Analyze with VLM using `image_analyzer`
4. Generate enhanced report with `text_generator`

**Benefits:**
- ðŸ§  **Intelligent**: Understands visual content layout
- ðŸ”„ **Comprehensive**: Handles any page type including SPAs
- ðŸ“± **Modern**: Works with dynamic JavaScript content
- ðŸŽ¨ **Visual**: Can analyze images, charts, complex layouts

### Automatic Selection Logic
```python
# Simplified decision logic
if is_html_content(url):
    result = bs4_extraction(url)      # Default: Fast BS4
    if bs4_result.success:
        return bs4_result
    else:
        return vlm_analysis(url)      # Fallback: Comprehensive VLM
else:
    return vlm_analysis(url)          # Non-HTML: Use VLM
```

## Architecture Components

### Core Services
1. **`bs4_service.py`** - Clean BeautifulSoup text extraction
2. **`image_analyzer.py`** - Generic VLM analysis (atomic function)
3. **`text_generator.py`** - LLM synthesis and analysis (atomic function)

### Processing Flow
```
URL Input â†’ BS4 Extraction â†’ [Success?] â†’ LLM Analysis â†’ Final Report
             â†“ [Failure]
         VLM Analysis â†’ LLM Enhancement â†’ Final Report
```

## Performance Characteristics

### BS4 Extraction (Default)
- **Speed**: 1-3 seconds
- **Cost**: Free (no AI calls for extraction)
- **Accuracy**: High for static content
- **Output**: Structured text data + optional LLM analysis

### VLM Analysis (Fallback)
- **Speed**: 5-15 seconds (tested and verified)
- **Cost**: AI model usage costs
- **Accuracy**: High for all content types
- **Output**: Rich visual analysis + LLM enhancement

### Multi-URL Comparison
- **Speed**: 3-10 seconds per URL + comparison synthesis
- **Cost**: Extraction costs + LLM synthesis
- **Output**: Individual results + comprehensive comparison report