# Vision Analyzer - ä¸¤å±‚AIè§†è§‰åˆ†æç³»ç»Ÿ

## æ¦‚è¿°

Vision Analyzer æ˜¯ä¸€ä¸ªåŸºäºä¸¤å±‚AIæ¶æ„çš„æ™ºèƒ½ç½‘é¡µè§†è§‰åˆ†æç³»ç»Ÿï¼Œç»“åˆäº†ISA Vision (OmniParser) çš„ç²¾ç¡®åæ ‡æ£€æµ‹å’ŒOpenAI Visionçš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼Œä¸ºç½‘é¡µè‡ªåŠ¨åŒ–æä¾›é«˜ç²¾åº¦çš„å…ƒç´ å®šä½å’Œåˆ†æã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ä¸¤å±‚AIæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Vision Analyzer                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: ISA Vision (OmniParser UI Detection)            â”‚
â”‚  â€¢ ç²¾ç¡®UIå…ƒç´ åæ ‡æ£€æµ‹                                       â”‚
â”‚  â€¢ å…ƒç´ ç±»å‹è¯†åˆ« (button, input, linkç­‰)                    â”‚
â”‚  â€¢ å¯äº¤äº’æ€§æ£€æµ‹                                            â”‚
â”‚  â€¢ ç½®ä¿¡åº¦è¯„åˆ†                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: OpenAI Vision (è¯­ä¹‰æ˜ å°„)                        â”‚
â”‚  â€¢ ä¸šåŠ¡é€»è¾‘è¯­ä¹‰ç†è§£                                        â”‚
â”‚  â€¢ å…ƒç´ åŠŸèƒ½æ˜ å°„ (username, password, submitç­‰)             â”‚
â”‚  â€¢ ä¸Šä¸‹æ–‡åˆ†æ                                              â”‚
â”‚  â€¢ æ™ºèƒ½æ¨ç†                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Fallback: ISA-Only Mapping                              â”‚
â”‚  â€¢ å½“OpenAIåˆ†æå¤±è´¥æ—¶çš„åå¤‡æ–¹æ¡ˆ                            â”‚
â”‚  â€¢ åŸºäºå†…å®¹å’Œç±»å‹çš„åŸºç¡€æ˜ å°„                                 â”‚
â”‚  â€¢ ä¿è¯ç³»ç»Ÿç¨³å®šæ€§                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ä¸»è¦åŠŸèƒ½

### 1. ç™»å½•è¡¨å•æ£€æµ‹ (`identify_login_form`)
- **è¾“å…¥**: Playwrighté¡µé¢å¯¹è±¡
- **è¾“å‡º**: ç™»å½•å…ƒç´ å­—å…¸ (username, password, submit)
- **ç‰¹ç‚¹**: 
  - ğŸ¯ ä¸¤å±‚AIç²¾ç¡®å®šä½
  - ğŸ’¾ ç»“æœç¼“å­˜ä¼˜åŒ–
  - âš¡ é¢„é…ç½®ç«™ç‚¹æ”¯æŒ
  - ğŸ”„ æ™ºèƒ½é™çº§æ–¹æ¡ˆ

### 2. æœç´¢è¡¨å•æ£€æµ‹ (`identify_search_form`)
- **è¾“å…¥**: Playwrighté¡µé¢å¯¹è±¡
- **è¾“å‡º**: æœç´¢å…ƒç´ å­—å…¸ (input, submit)
- **ç‰¹ç‚¹**:
  - ğŸ” è¯­ä¹‰æœç´¢ç†è§£
  - ğŸ“‹ å¤šç§æœç´¢æ¡†æ ¼å¼æ”¯æŒ
  - ğŸ¨ ç°ä»£UIé€‚é…

### 3. å¯¼èˆªå…ƒç´ åˆ†æ (`analyze_ui_elements`)
- **è¾“å…¥**: é¡µé¢å¯¹è±¡å’Œä»»åŠ¡ç±»å‹
- **è¾“å‡º**: å¯¼èˆªå…ƒç´ ç»“æ„åŒ–æ•°æ®
- **ç‰¹ç‚¹**:
  - ğŸ§­ æ™ºèƒ½å¯¼èˆªåˆ†ç±»
  - ğŸ”— é“¾æ¥å±‚æ¬¡åˆ†æ
  - ğŸ“± å“åº”å¼å¸ƒå±€æ”¯æŒ

### 4. ä¸‹è½½é“¾æ¥æ£€æµ‹ (`identify_download_links`)
- **è¾“å…¥**: Playwrighté¡µé¢å¯¹è±¡
- **è¾“å‡º**: ä¸‹è½½é“¾æ¥åˆ—è¡¨
- **ç‰¹ç‚¹**:
  - ğŸ“¥ å¤šæ–‡ä»¶ç±»å‹æ”¯æŒ
  - ğŸ¯ ç²¾ç¡®åæ ‡å®šä½
  - ğŸ“Š ç½®ä¿¡åº¦è¯„åˆ†

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### ISA Vision Layer (ç¬¬ä¸€å±‚)
```python
# ISA OmniParser UIæ£€æµ‹è°ƒç”¨
isa_result = await self.client.invoke(
    input_data=screenshot_path,
    task="detect_ui_elements",
    service_type="vision", 
    model="isa-omniparser-ui-detection",
    provider="isa"
)
```

### OpenAI Vision Layer (ç¬¬äºŒå±‚)
```python
# OpenAIè¯­ä¹‰åˆ†æè°ƒç”¨
openai_result = await self.client.invoke(
    screenshot_path,
    "analyze", 
    "vision",
    prompt=semantic_prompt
)
```

### ç¼“å­˜ç³»ç»Ÿ
- **L1 ç¼“å­˜**: é¢„é…ç½®ç«™ç‚¹å…ƒç´  (å³æ—¶å“åº”)
- **L2 ç¼“å­˜**: å†å²åˆ†æç»“æœ (å¿«é€Ÿå“åº”)
- **L3 ç¼“å­˜**: AIåˆ†æç»“æœ (å‡†ç¡®å“åº”)

## ğŸ“Š æµ‹è¯•ç»“æœ

### å…¨é¢æµ‹è¯•é€šè¿‡ç‡: 100% (4/4)

```
ğŸ¯ Overall: 4/4 tests passed
ğŸ‰ All vision analyzer tests passed!
âœ… Two-layer AI analysis system working correctly!
ğŸš€ Ready for production use!
```

#### è¯¦ç»†æµ‹è¯•ç»“æœ:

1. **ç™»å½•æ£€æµ‹**: âœ… 100% æˆåŠŸç‡
   - æ£€æµ‹åˆ° 3/3 å…ƒç´ 
   - åæ ‡: username(958,262), password(958,349), submit(960,412)
   - ç½®ä¿¡åº¦: 0.90 (OpenAIè¯­ä¹‰åˆ†æ)

2. **æœç´¢æ£€æµ‹**: âœ… 100% æˆåŠŸç‡
   - æ£€æµ‹åˆ° 2/2 å…ƒç´ 
   - åæ ‡: input(909,167), submit(1157,167)
   - ç½®ä¿¡åº¦: 0.90 (OpenAIè¯­ä¹‰åˆ†æ)

3. **å¯¼èˆªæ£€æµ‹**: âœ… ç»“æ„åŒ–å¯¼èˆªåˆ†æ
   - è¯†åˆ«å¯¼èˆªé“¾æ¥ã€æŒ‰é’®ã€èœå•å®¹å™¨
   - æ”¯æŒè¯­ä¹‰åˆ†ç±»å’Œå±‚æ¬¡ç»“æ„

4. **é“¾æ¥æ£€æµ‹**: âœ… å¤šç§æ£€æµ‹æ–¹å¼
   - ä¼ ç»Ÿé€‰æ‹©å™¨ + AIè§†è§‰åˆ†æ
   - æ–‡ä»¶ç±»å‹æ™ºèƒ½è¯†åˆ«

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨
```python
from vision_analyzer import VisionAnalyzer

analyzer = VisionAnalyzer()

# ç™»å½•è¡¨å•æ£€æµ‹
login_elements = await analyzer.identify_login_form(page)
print(f"æ‰¾åˆ° {len(login_elements)} ä¸ªç™»å½•å…ƒç´ ")

# æœç´¢è¡¨å•æ£€æµ‹
search_elements = await analyzer.identify_search_form(page)
print(f"æ‰¾åˆ° {len(search_elements)} ä¸ªæœç´¢å…ƒç´ ")

# æ¸…ç†èµ„æº
await analyzer.close()
```

## ğŸ“ API å‚è€ƒ

### ä¸»è¦æ–¹æ³•

| æ–¹æ³• | æè¿° | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| `identify_login_form(page)` | ç™»å½•è¡¨å•æ£€æµ‹ | Pageå¯¹è±¡ | Dict[str, Any] |
| `identify_search_form(page)` | æœç´¢è¡¨å•æ£€æµ‹ | Pageå¯¹è±¡ | Dict[str, Any] |
| `analyze_ui_elements(page, task_type)` | é€šç”¨UIåˆ†æ | Pageå¯¹è±¡, ä»»åŠ¡ç±»å‹ | Dict[str, Any] |
| `identify_download_links(page)` | ä¸‹è½½é“¾æ¥æ£€æµ‹ | Pageå¯¹è±¡ | List[Dict[str, str]] |
| `get_cache_stats()` | ç¼“å­˜ç»Ÿè®¡ | æ—  | Dict[str, Any] |
| `close()` | èµ„æºæ¸…ç† | æ—  | None |

### è¿”å›æ ¼å¼

#### ç™»å½•å…ƒç´ æ ¼å¼
```python
{
    "username": {
        "type": "coordinate",
        "x": 958,
        "y": 262,
        "action": "type",
        "description": "OpenAI semantic: email input field",
        "confidence": 0.90,
        "source": "openai_semantic"
    },
    "password": { ... },
    "submit": { ... }
}
```

---

*Vision Analyzer v2.0 - åŸºäºä¸¤å±‚AIæ¶æ„çš„æ™ºèƒ½ç½‘é¡µè§†è§‰åˆ†æç³»ç»Ÿ*