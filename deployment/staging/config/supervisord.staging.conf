[supervisord]
nodaemon=true
user=app
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/log/supervisor/supervisord.pid
childlogdir=/var/log/isa-mcp
loglevel=info

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# ============================================
# MCP Server with Hot Reload
# ============================================
[program:mcp_server]
command=python -m uvicorn main:app --host 0.0.0.0 --port 8081 --reload --log-level info
directory=/app
user=app
autostart=true
autorestart=true
startsecs=5
startretries=3
# Output to stdout/stderr for Docker logs AND Loki (双重保障)
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app",SERVICE_NAME="mcp_server"
priority=10

# ============================================
# Optional: Consul Registration (if enabled)
# ============================================
# [program:consul_registration]
# command=python /app/scripts/register_consul.py
# directory=/app
# user=app
# autostart=false
# autorestart=true
# startsecs=5
# startretries=3
# stdout_logfile=/var/log/isa-mcp/consul_registration.log
# stdout_logfile_maxbytes=10MB
# stdout_logfile_backups=2
# stderr_logfile=/var/log/isa-mcp/consul_registration_error.log
# stderr_logfile_maxbytes=10MB
# stderr_logfile_backups=2
# environment=PYTHONPATH="/app",SERVICE_NAME="consul_registration"
